{% extends "base.html" %}
{% block title %}{{ project.name }}{% endblock %}

{% block content %}
  <div class="mb-3">
    <a class="btn btn-link p-0" href="{% url 'dashboard' %}">← Back to dashboard</a>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h1 class="h4 mb-1">{{ project.name }}</h1>
      {% if project.description %}
        <p class="text-muted mb-0">{{ project.description }}</p>
      {% endif %}
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h2 class="h5 mb-3">Create a task</h2>
      <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button class="btn btn-success" type="submit">Add Task</button>
      </form>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <h2 class="h5 mb-3">Tasks</h2>

      <ul class="list-group list-group-flush">
        {% for task in tasks %}
        <div class="mb-3 d-flex gap-2 flex-wrap">
  <a class="btn {% if status_filter == 'ALL' %}btn-primary{% else %}btn-outline-primary{% endif %}"
     href="{% url 'project_detail' project.id %}">
    All
  </a>

  <a class="btn {% if status_filter == 'TODO' %}btn-primary{% else %}btn-outline-primary{% endif %}"
     href="{% url 'project_detail' project.id %}?status=TODO">
    To Do
  </a>

  <a class="btn {% if status_filter == 'DOING' %}btn-primary{% else %}btn-outline-primary{% endif %}"
     href="{% url 'project_detail' project.id %}?status=DOING">
    Doing
  </a>

  <a class="btn {% if status_filter == 'DONE' %}btn-primary{% else %}btn-outline-primary{% endif %}"
     href="{% url 'project_detail' project.id %}?status=DONE">
    Done
  </a>
</div>

          <li class="list-group-item">
            <div class="d-flex justify-content-between align-items-start gap-3">
              <div>
                <a class="text-decoration-none fw-semibold" href="{% url 'task_detail' task.id %}">
                  {{ task.title }}
                </a>
                <div class="text-muted small">
                  Priority: {{ task.get_priority_display }} · Status: {{ task.get_status_display }}
                </div>
              </div>

              <form class="d-flex align-items-center gap-2" method="post" action="{% url 'update_task_status' task.id %}">
                {% csrf_token %}
                <select class="form-select form-select-sm" name="status">
                  {% for value,label in task.STATUS_CHOICES %}
                    <option value="{{ value }}" {% if task.status == value %}selected{% endif %}>
                      {{ label }}
                    </option>
                  {% endfor %}
                </select>
                <button class="btn btn-outline-primary btn-sm" type="submit">Update</button>
              </form>
            </div>
          </li>
        {% empty %}
          <li class="list-group-item">No tasks in this project yet.</li>
        {% endfor %}
      </ul>
    </div>
  </div>
{% endblock %}
